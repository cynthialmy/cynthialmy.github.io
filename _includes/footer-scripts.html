{% if layout.common-ext-js %}
  {% for js in layout.common-ext-js %}
    {% include ext-js.html js=js %}
  {% endfor %}
{% endif %}

{% if layout.common-js %}
  {% for js in layout.common-js %}
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    {% if js contains 'jquery' %}
      <script>
        if (typeof jQuery == 'undefined') {
          document.write('<script src="{{ js | relative_url }}"></scr' + 'ipt>');
        }
      </script>
    {% else %}
      <script src="{{ js | relative_url }}"></script>
    {% endif %}
  {% endfor %}
{% endif %}

{% if site.site-js %}
  {% for js in site.site-js %}
    <script src="{{ js | relative_url }}"></script>
  {% endfor %}
{% endif %}

{% if page.ext-js %}
  {% for js in page.ext-js %}
    {% include ext-js.html js=js %}
  {% endfor %}
{% endif %}

{% if page.js %}
  {% for js in page.js %}
    <script src="{{ js | relative_url }}"></script>
  {% endfor %}
{% endif %}

<script>
  (function () {
    var mermaidBlocks = document.querySelectorAll('code.language-mermaid, code.mermaid');
    if (!mermaidBlocks.length) {
      return;
    }

    function renderMermaid() {
      mermaid.initialize({ startOnLoad: false });
      mermaidBlocks.forEach(function (codeEl) {
        var preEl = codeEl.parentElement;
        var container = document.createElement('div');
        container.className = 'mermaid';
        container.textContent = codeEl.textContent;
        if (preEl && preEl.parentElement) {
          preEl.parentElement.replaceChild(container, preEl);
        }
      });
      mermaid.init(undefined, document.querySelectorAll('.mermaid'));
    }

    var script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js';
    script.defer = true;
    script.onload = renderMermaid;
    document.body.appendChild(script);
  })();
</script>
